# Template file for 'libnvidia-container'
pkgname=libnvidia-container
version=1.0.5
revision=1
archs="x86_64"
build_style=meta
hostmakedepends="tar curl bmake groff m4 pkg-config"
makedepends="rpcsvc-proto libcap-devel libseccomp-devel libtirpc-devel"
short_desc="NVIDIA container runtime library"
maintainer="Soroush <soroosh.haeri@me.com>"
license="Apache-2.0"
homepage="https://github.com/NVIDIA/libnvidia-container"
distfiles="https://github.com/NVIDIA/libnvidia-container/archive/v${version}.tar.gz"
checksum="b0b1a03f33ce7afdc06c432c7e100b17dc1723420293c27201c50bcb9b851e5a"

do_build() {
	make dist prefix=/usr
}

pre_install() {
	cd dist
	tar xvf ${pkgname}_${version}_${archs}.tar.xz
}

do_install() {
	# install lib files
	vinstall dist/${pkgname}_${version}/usr/lib/${pkgname}.a 644 /usr/lib/
	vinstall dist/${pkgname}_${version}/usr/lib/${pkgname}.so.${version} 755 /usr/lib/
	# create symlink
	vinstall dist/${pkgname}_${version}/usr/lib/debug/usr/lib/${pkgname}.so.1 755  /usr/lib/debug/usr/lib/
	vinstall dist/${pkgname}_${version}/usr/lib/pkgconfig/${pkgname}.pc 644 /usr/lib/pkgconfig/
	# put docs in place
	vdoc dist/${pkgname}_${version}/usr/share/doc/libnvidia-container-1.0.5/COPYING
	vdoc dist/${pkgname}_${version}/usr/share/doc/libnvidia-container-1.0.5/COPYING.LESSER
	vdoc dist/${pkgname}_${version}/usr/share/doc/libnvidia-container-1.0.5/LICENSE
	vdoc dist/${pkgname}_${version}/usr/share/doc/libnvidia-container-1.0.5/NOTICE
	# put binary in place
	vbin dist/${pkgname}_${version}/usr/bin/nvidia-container-cli
	# put includes
	vinstall dist/${pkgname}_${version}/usr/include/nvc.h 644 /usr/include/
}
